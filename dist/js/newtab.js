/*! (c) Philipp König under GPL-3.0 */
(e=>{"use strict";window.EntryHelper=function(e){let t=!1,l={},a={},i={},s={bookmarks:{},directories:{},pinned:{}};this.init=(e=>(t=!0,new Promise(t=>{this.update(e).then(t)}))),this.initOnce=(()=>new Promise(e=>{t?e():this.init().then(e)})),this.getAmount=(t=>{if(r(),0===Object.keys(l).length&&(l=e.helper.model.getData("u/entryAmounts")),l&&l[t]){let e=l[t].visible;return a.showHidden&&(e+=l[t].hidden),e}return null}),this.getAllDataByType=(e=>Object.values(s[e]||{})),this.getDataById=(e=>{let t=null;return"object"==typeof s.bookmarks[e]?(t=s.bookmarks[e],"object"==typeof s.pinned[e]&&(t.pinnedIndex=s.pinned[e].index)):"object"==typeof s.directories[e]&&(t=s.directories[e]),t}),this.addData=((e,t,l)=>{"object"==typeof s.bookmarks[e]?("pinnedIndex"===t&&"object"==typeof s.pinned[e]&&(s.pinned[e].index=l),s.bookmarks[e][t]=l):"object"==typeof s.directories[e]&&(s.directories[e][t]=l)}),this.isSeparator=(e=>{let t=!1;if("object"==typeof s.bookmarks[e]){let l=s.bookmarks[e].title.replace(/[^-_]/g,"");t="about:blank"===s.bookmarks[e].url&&l.length===s.bookmarks[e].title.length}return t}),this.isVisible=(e=>{let t=!1;return"object"==typeof s.bookmarks[e]?t=!1===s.bookmarks[e].hidden:"object"==typeof s.directories[e]&&(t=!1===s.directories[e].hidden),t}),this.update=((t=null)=>new Promise(a=>{r();let o=[e.helper.model.call("viewAmounts")];null===t&&o.push(e.helper.model.call("bookmarks",{id:0})),Promise.all(o).then(r=>{i=r[0],null===t&&r[1]&&r[1].bookmarks&&r[1].bookmarks[0]&&r[1].bookmarks[0].children&&(t=r[1].bookmarks[0].children),s={bookmarks:{},directories:{},pinned:{}},l={bookmarks:{visible:0,hidden:0},directories:{visible:0,hidden:0},pinned:{visible:0,hidden:0}},n(t),e.helper.model.setData({"u/entryAmounts":l}),a()})}));let r=()=>{a=e.helper.model.getData(["u/hiddenEntries","u/additionalInfo","u/pinnedEntries","u/showHidden"])},n=(e,t=[],l=!1)=>{e.forEach(e=>{let s=[...t];"0"!==e.parentId&&s.push(e.parentId),e.additionalInfo=a.additionalInfo[e.id]||{},e.hidden=l||!0===a.hiddenEntries[e.id],e.parents=s,e.views={startDate:+new Date(Math.max(e.dateAdded,i.counterStartDate)),total:0},e.url?d(e):e.children&&o(e)})},o=e=>{e.childrenAmount={bookmarks:0,directories:0,total:0},e.parents.forEach(e=>{s.directories[e].childrenAmount.directories++}),s.directories[e.id]=e,n(e.children,e.parents,e.hidden),e.isDir=!0,e.childrenAmount.total=e.childrenAmount.bookmarks+e.childrenAmount.directories,e.views.perMonth=Math.round(e.views.total/h(e.views.startDate)*100)/100,l.directories[e.hidden?"hidden":"visible"]++},d=e=>{let t=0,r=0;if(i.viewAmounts[e.id]&&(t=i.viewAmounts[e.id].c,r=i.viewAmounts[e.id].d||0),e.views.total=t,e.views.lastView=r,e.views.perMonth=Math.round(t/h(e.views.startDate)*100)/100,e.parents.forEach(e=>{s.directories[e]&&(s.directories[e].childrenAmount.bookmarks++,s.directories[e].views.total+=t,s.directories[e].views.lastView=Math.max(s.directories[e].views.lastView||0,r))}),e.pinned=!1,s.bookmarks[e.id]=e,!1===this.isSeparator(e.id)&&l.bookmarks[e.hidden?"hidden":"visible"]++,a.pinnedEntries[e.id]){e.pinned=!0;let t=Object.assign({},e);t.index=a.pinnedEntries[e.id].index,delete t.parents,delete t.parentId,s.pinned[e.id]=t,l.pinned[e.hidden?"hidden":"visible"]++}},h=e=>Math.max(1,Math.round((+new Date-e)/2627999942.4))},window.EditHelper=function(t){let l=!1;this.init=(async()=>{a(),t.opts.elm.body.attr(t.attr.pos,t.helper.model.getData("b/sidebarPosition")),e("<a />").addClass(t.cl.edit).appendTo(t.opts.elm.body),location.href.search(/#edit$/i)>-1&&r()}),this.isEditMode=(()=>l);let a=()=>{t.opts.elm.body.on("click","a."+t.cl.edit,e=>{e.preventDefault(),l||r()}).on("click","menu."+t.cl.infoBar+" > a",l=>{l.preventDefault();let a=e(l.currentTarget);a.hasClass(t.cl.cancel)?s():a.hasClass(t.cl.save)&&i().then(()=>{s()})})},i=()=>new Promise(l=>{let a=[];t.opts.elm.topNav.find("a."+t.cl.link).forEach(t=>{let l=e(t).text().trim(),i=(e(t).data("href")||e(t).attr("href")).trim();l&&l.length>0&&i&&i.length>0&&a.push({label:l,url:i})});let i=+new Date,s=t.helper.template.loading().appendTo(t.opts.elm.body);t.opts.elm.body.addClass(t.cl.loading),t.helper.model.setData({"n/searchEngine":t.opts.elm.search.wrapper.children("select")[0].value,"n/topPagesType":t.opts.elm.topPages.children("select")[0].value,"n/shortcuts":a}).then(()=>e.delay(Math.max(0,1e3-(+new Date-i)))).then(()=>{t.opts.elm.body.removeClass(t.cl.loading),s.remove(),l()})}),s=()=>{l=!1,history.pushState({},null,location.href.replace(/#edit/g,"")),t.opts.elm.body.removeClass(t.cl.edit),t.opts.elm.search.wrapper.children("select").remove(),t.opts.elm.topPages.children("select").remove(),t.opts.elm.topNav.find("a:not(."+t.cl.link+")").remove(),t.helper.search.updateSearchEngine(t.helper.model.getData("n/searchEngine")),t.helper.topPages.setType(t.helper.model.getData("n/topPagesType")),t.helper.shortcuts.refreshEntries(),e.delay(500).then(()=>{e("menu."+t.cl.infoBar).remove()})},r=()=>{l=!0,history.pushState({},null,location.href.replace(/#edit/g,"")+"#edit"),e("<menu />").addClass(t.cl.infoBar).append("<a class='"+t.cl.cancel+"'>"+t.helper.i18n.get("overlay_cancel")+"</a>").append("<a class='"+t.cl.save+"'>"+t.helper.i18n.get("settings_save")+"</a>").appendTo(t.opts.elm.body),e.delay().then(()=>{t.opts.elm.body.addClass(t.cl.edit),h(),d(),n(),e.delay(500).then(()=>{e(window).trigger("resize")})})},n=()=>{let l=["<a class='"+t.cl.edit+"' />","<a class='"+t.cl.remove+"' />","<a "+t.attr.pos+"='left' />","<a "+t.attr.pos+"='right' />"];t.opts.elm.topNav.find("> ul > li").forEach(t=>{e(t).append(l)}),e("<a class='"+t.cl.add+"' />").prependTo(t.opts.elm.topNav),t.opts.elm.topNav.off("click.edit").on("click.edit","a."+t.cl.edit,t=>{t.stopPropagation();let l=e(t.currentTarget).parent("li");o(l)}).on("click.edit","a."+t.cl.add,()=>{let a=e("<li />").append("<a class='"+t.cl.link+"'>&nbsp;</a>").append(l).prependTo(t.opts.elm.topNav.children("ul"));e.delay().then(()=>{o(a)})}).on("click.edit","a."+t.cl.remove,t=>{e(t.currentTarget).parent("li").remove()}).on("click.edit","a["+t.attr.pos+"]",l=>{let a=e(l.currentTarget).attr(t.attr.pos),i=e(l.currentTarget).parent("li");switch(a){case"left":i.prev("li").length()>0&&i.insertBefore(i.prev("li"));break;case"right":i.next("li").length()>0&&i.insertAfter(i.next("li"))}}).on("click.edit","> ul > li > div",e=>{"BUTTON"!==e.target.tagName&&e.stopPropagation()}),e(document).off("click.edit").on("click.edit",()=>{t.opts.elm.topNav.find("> ul > li > div").remove()})},o=l=>{t.opts.elm.topNav.find("> ul > li > div").remove();let a=l.children("a."+t.cl.link).eq(0);e("<div />").append("<label>"+t.helper.i18n.get("overlay_bookmark_title")+"</label>").append("<input type='text' value='"+a.text().trim().replace(/'/g,"&#x27;")+"' "+t.attr.type+"='label' />").append("<label>"+t.helper.i18n.get("overlay_bookmark_url")+"</label>").append("<input type='text' value='"+(a.data("href")||a.attr("href")).trim().replace(/'/g,"&#x27;")+"' "+t.attr.type+"='url' />").append("<button type='submit'>"+t.helper.i18n.get("overlay_close")+"</button>").appendTo(l).find("input[type='text']").on("change input",l=>{let i=l.currentTarget.value.trim();switch(e(l.currentTarget).attr(t.attr.type)){case"url":a.removeAttr("href").removeData("href"),i&&i.length>0&&(i.startsWith("chrome://")||i.startsWith("chrome-extension://")?a.data("href",i):(0!==i.search(/^\w+:\/\//)&&(i="http://"+i),a.attr("href",i)));break;case"label":i&&i.length>0?a.text(i.trim()):a.html("&nbsp;")}})},d=()=>{let l=e("<select />").prependTo(t.opts.elm.topPages),a=t.helper.topPages.getAllTypes(),i=t.helper.model.getData("n/topPagesType");Object.keys(a).forEach(s=>{let r=t.helper.i18n.get("newtab_top_pages_"+a[s]);e("<option value='"+s+"' "+(i===s?"selected":"")+" />").text(r).appendTo(l)}),l.on("input change",e=>{t.helper.topPages.setType(e.currentTarget.value)})},h=()=>{let l=e("<select />").appendTo(t.opts.elm.search.wrapper),a=t.helper.search.getSearchEngineList(),i=t.helper.model.getData("n/searchEngine");Object.entries(a).forEach(([t,a])=>{e("<option value='"+t+"' "+(i===t?"selected":"")+" />").text(a.name).appendTo(l)}),l.on("input change",e=>{t.helper.search.updateSearchEngine(e.currentTarget.value)})}},window.FallbackHelper=function(t){this.init=(async()=>{let e=new URL(location.href).searchParams.get("type");null!==e&&(t.opts.elm.topPages.addClass(t.cl.hidden),t.opts.elm.fallbackInfo.addClass(t.cl.active),s(e),l(e),"new_tab"!==e&&"fallback"!==e||!1!==t.helper.model.getData("n/override")||a(),t.helper.model.call("trackEvent",{category:"newtab",action:"fallback",label:e,always:!0}))});let l=e=>{t.opts.elm.fallbackInfo.children("a").on("click",t=>{t.preventDefault();let l="general";switch(e){case"notWhitelisted":case"blacklisted":l="filter"}chrome.tabs.create({url:chrome.extension.getURL("html/settings.html#feedback_error_"+l)})})},a=()=>{let l=e("<div />").appendTo(t.opts.elm.fallbackInfo),a=t.helper.checkbox.get(t.opts.elm.body,{},"checkbox","switch").appendTo(l);e("<span />").html(t.helper.i18n.get("newtab_fallback_set_as_new_tab")).insertAfter(a),a.children("input[type='checkbox']").on("change",e=>{e.currentTarget.checked?chrome.permissions.request({permissions:["tabs","topSites"]},e=>{e?i(!0):a.trigger("click")}):i(!1)})},i=e=>{chrome.storage.sync.get(["newtab"],l=>{let a=l.newtab||{};a.override=e,chrome.storage.sync.set({newtab:a},()=>{t.enabledSetAsNewtab=!0,t.helper.model.call("reinitialize")})})},s=l=>{let a={headline:"newtab_fallback_headline_general",desc:"newtab_fallback_desc",link:"newtab_fallback_link"};switch(l){case"new_tab":case"system":case"extension_page":case"webstore":a.headline="newtab_fallback_headline_"+l;break;case"notWhitelisted":case"blacklisted":a.headline="newtab_fallback_headline_url_filter"}e("<h2 />").text(t.helper.i18n.get(a.headline)).appendTo(t.opts.elm.fallbackInfo),e("<p />").text(t.helper.i18n.get(a.desc)).appendTo(t.opts.elm.fallbackInfo),e("<a />").text(t.helper.i18n.get(a.link)).appendTo(t.opts.elm.fallbackInfo)}},window.SearchHelper=function(t){let l={},a=null,i={},s={google:{name:"Google",url:"https://www.google.com/",queryUrl:"https://www.google.com/search?q={1}",sorting:10},bing:{name:"Bing",url:"https://www.bing.com/",queryUrl:"https://www.bing.com/search?q={1}",sorting:20},yahoo:{name:"Yahoo",url:"https://search.yahoo.com/",queryUrl:"https://search.yahoo.com/search?p={1}",sorting:30,lang:{de:{url:"https://de.search.yahoo.com/",queryUrl:"https://de.search.yahoo.com/search?p={1}"},jp:{url:"https://search.yahoo.co.jp/",queryUrl:"https://search.yahoo.co.jp/search?p={1}"}}},duckduckgo:{name:"DuckDuckGo",url:"https://duckduckgo.com/",queryUrl:"https://duckduckgo.com/?q={1}",sorting:40},yandex:{name:"Yandex",url:"https://yandex.com/",queryUrl:"https://yandex.com/search/?text={1}",sorting:50,lang:{ru:{name:"Яндекс",url:"https://yandex.ru/",queryUrl:"https://yandex.ru/search/?text={1}",sorting:15},uk:{name:"Яндекс",url:"https://yandex.ua/",queryUrl:"https://yandex.ua/search/?text={1}",sorting:15},tr:{url:"https://yandex.com.tr/",queryUrl:"https://yandex.com.tr/search/?text={1}",sorting:15}}},baidu:{name:"Baidu",url:"https://www.baidu.com/",queryUrl:"https://www.baidu.com/s?wd={1}",sorting:60,lang:{"zh-CN":{name:"百度",sorting:15}}}};this.init=(async()=>{r(),d(),this.updateSearchEngine(t.helper.model.getData("n/searchEngine"))}),this.updateSearchEngine=(e=>{if(i[e]){a=e;let l=t.helper.i18n.get("newtab_search_placeholder",[i[e].name]);t.opts.elm.search.field.attr("placeholder",l)}}),this.getSearchEngineList=(()=>i);let r=()=>{let e=t.helper.i18n.getUILanguage(),l=[];Object.entries(s).forEach(([t,a])=>{let i={alias:t,name:a.name,url:a.url,queryUrl:a.queryUrl,sorting:a.sorting};a.lang&&a.lang[e]&&Object.entries(a.lang[e]).forEach(([e,t])=>{i[e]=t}),i.name&&i.url&&i.queryUrl&&l.push(i)}),l.sort((e,t)=>(e.sorting||9999)-(t.sorting||9999)),i={},l.forEach(e=>{i[e.alias]=e})},n=l=>{let a=e("ul."+t.cl.suggestions+" > li."+t.cl.active),i="next"===l?0:-1;a.length()>0&&(i=a.prevAll("li").length()+("next"===l?1:-1),a.removeClass(t.cl.active));let s=!1;if(i>=0){let l=e("ul."+t.cl.suggestions+" > li").eq(i);l.length()>0&&(s=!0,l.addClass(t.cl.active),t.opts.elm.search.field[0].value=l.text().trim())}!1===s&&(t.opts.elm.search.field[0].value=t.opts.elm.search.field.data("typedVal")||"")},o=e=>{e&&e.trim().length>0&&(0===e.search(/https?\:\/\//)||0===e.search(/s?ftps?\:\/\//)||0===e.search(/chrome\:\/\//)?chrome.tabs.update({url:e}):i[a]&&chrome.tabs.update({url:i[a].queryUrl.replace("{1}",encodeURIComponent(e))}))},d=()=>{t.opts.elm.search.submit.on("click",e=>{e.preventDefault(),e.stopPropagation();let l=t.opts.elm.search.field[0].value;l&&l.trim().length>0?o(l):i[a]&&chrome.tabs.update({url:i[a].url})}),t.opts.elm.search.field.on("keyup click",a=>{a.preventDefault(),a.stopPropagation();let i=a.currentTarget.value,s=event.which||event.keyCode;13===s?o(i):40===s?n("next"):38===s?n("prev"):(t.opts.elm.search.field.data("typedVal",i),(t=>new Promise(a=>{if(t)if(l[t])a(l[t]);else{let i=encodeURIComponent(t),s=(e=[])=>{l[t]=e,a(e)};e.xhr("http://google.com/complete/search?client=chrome&q="+i,{responseType:"json"}).then(e=>{try{if(e.response&&e.response[0]===t){let t=[],l=[];e.response[1].forEach((a,i)=>{"NAVIGATION"===e.response[4]["google:suggesttype"][i]?t.push({type:"url",label:a}):l.push({type:"word",label:a})}),s(t.concat(l))}}catch(e){s()}},()=>{s()})}else a([])}))(i).then(l=>{if(e("ul."+t.cl.suggestions).remove(),l.length>0){let a=e("<ul />").addClass(t.cl.suggestions).insertAfter(t.opts.elm.search.field);l.some((l,i)=>{if(e("<li />").attr(t.attr.type,l.type).text(l.label).appendTo(a),i>4)return!0}),a.css({top:t.opts.elm.search.field[0].offsetTop+"px",left:t.opts.elm.search.field[0].offsetLeft+"px"})}}))}),e(document).on("mousemove","ul."+t.cl.suggestions+" > li",l=>{e("ul."+t.cl.suggestions+" > li").removeClass(t.cl.active),e(l.currentTarget).addClass(t.cl.active)}).on("click","ul."+t.cl.suggestions+" > li",l=>{l.preventDefault(),l.stopPropagation();let a=e(l.currentTarget).text().trim();t.opts.elm.search.field[0].value=a,o(a)}),e(document).on("click",()=>{e("ul."+t.cl.suggestions).remove(),!1===t.helper.edit.isEditMode()&&t.opts.elm.search.field[0].focus()}),e(window).on("resize",()=>{e("ul."+t.cl.suggestions).remove()})}},window.ShortcutsHelper=function(t){this.init=(async()=>{this.refreshEntries(),l()}),this.refreshEntries=(()=>{let l=t.helper.model.getData("n/shortcuts");t.opts.elm.topNav.children("ul").remove();let a=e("<ul />").appendTo(t.opts.elm.topNav);l&&l.length>0&&l.forEach(l=>{let i=e("<li />").appendTo(a),s=e("<a />").addClass(t.cl.link).text(l.label).appendTo(i);l.url.startsWith("chrome://")||l.url.startsWith("chrome-extension://")?s.data("href",l.url):s.attr("href",l.url)})});let l=()=>{t.opts.elm.topNav.on("mousedown","a."+t.cl.link,l=>{let a=e(l.currentTarget).data("href");a&&(l.preventDefault(),t.helper.model.call("openLink",{href:a,newTab:2===l.which,position:t.helper.model.getData("b/newTabPosition"),active:2!==l.which}))})}},window.TopPagesHelper=function(t){let l=null,a=!1,i={topPages:"default",mostUsed:"most_used",recentlyUsed:"recently_used",pinnedEntries:"pinned_entries",hidden:"hidden"};this.init=(async()=>{s(),t.opts.elm.topPages.html("<ul />"),this.setType(t.helper.model.getData("n/topPagesType")),setInterval(()=>{document.hidden&&n()},12e4)}),this.getAllTypes=(()=>i),this.setType=(e=>{l===e&&"hidden"!==l||(l=e,n())}),this.handleWindowResize=(()=>{let e=r(),l=t.opts.elm.topPages.children("ul").data("total");e.total!==l&&n()});let s=()=>{e(window).on("resize.topPages",()=>{this.handleWindowResize()})},r=()=>{let l={total:8,rows:2},a={w:t.opts.elm.content[0].offsetWidth||window.innerWidth,h:t.opts.elm.content[0].offsetHeight||window.innerHeight},i=e("menu."+t.cl.infoBar);return i.length()>0&&(a.h-=i[0].offsetHeight),a.w>650?l.total=8:a.w>490?l.total=6:a.w>340?l.total=4:l.total=0,a.h<330?l.total=0:a.h<470&&(l.total/=2,l.rows=1),l},n=()=>{t.opts.elm.topPages.children("ul").removeClass(t.cl.visible),"hidden"===l?!1===t.helper.edit.isEditMode()&&t.opts.elm.topPages.children("ul").data("total",0).html(""):!1===a&&(a=!0,Promise.all([d(),e.delay(200)]).then(([l])=>{let a=r();return t.opts.elm.topPages.children("ul").html("").data("total",a.total).attr(t.attr.perRow,a.total/a.rows),l.forEach(l=>{let a=e("<li />").appendTo(t.opts.elm.topPages.children("ul")),i=e("<a />").attr({href:l.url,title:l.title}).appendTo(a),s=e("<span />").text(l.title).appendTo(i);t.helper.model.call("favicon",{url:l.url}).then(e=>{e.img&&s.prepend("<img src='"+e.img+"' />")});let r=e("<img />").appendTo(i);!1===t.helper.utility.isUrlOnBlacklist(l.url)&&t.helper.model.call("thumbnail",{url:l.url}).then(e=>{e.img&&r.attr("src",e.img).addClass(t.cl.visible)})}),e.delay(100)}).then(()=>{t.opts.elm.topPages.children("ul").addClass(t.cl.visible),a=!1}))},o=()=>new Promise(e=>{t.helper.entry.init().then(()=>{e()})}),d=()=>new Promise(e=>{let t=r();if(t.total>0)switch(l){case"mostUsed":case"recentlyUsed":o().then(()=>{let t=p(l);e(t)});break;case"pinnedEntries":o().then(()=>{let t=h();e(t)});break;case"topPages":default:chrome.topSites&&chrome.topSites.get&&chrome.topSites.get(l=>{if(void 0===chrome.runtime.lastError&&l){let a=l.slice(0,t.total);e(a)}else e([])})}else e([])}),h=()=>{let e=t.helper.entry.getAllDataByType("pinned"),l=t.helper.model.getData(["u/showHidden"]),a=r(),i=[];return e.some(e=>{if((l.showHidden||t.helper.entry.isVisible(e.id))&&!1===t.helper.entry.isSeparator(e.id)&&(i.push(e),i.length>=a.total))return!0}),i},p=e=>{let l=r(),a=t.helper.entry.getAllDataByType("bookmarks"),i=t.helper.model.getData(["u/showHidden","u/mostViewedPerMonth"]),s=t.helper.i18n.getLocaleSortCollator();"recentlyUsed"===e?a.sort((e,l)=>{let a=t.helper.entry.getDataById(e.id),i=t.helper.entry.getDataById(l.id),r=a?a.views.lastView:0,n=i?i.views.lastView:0;return r===n?s.compare(e.title,l.title):n-r}):"mostUsed"===e&&a.sort((e,l)=>{let a=t.helper.entry.getDataById(e.id),r=t.helper.entry.getDataById(l.id),n=a?a.views[i.mostViewedPerMonth?"perMonth":"total"]:0,o=r?r.views[i.mostViewedPerMonth?"perMonth":"total"]:0;return n===o?s.compare(e.title,l.title):o-n});let n=[];return a.some(e=>{if((i.showHidden||t.helper.entry.isVisible(e.id))&&!1===t.helper.entry.isSeparator(e.id)&&0!==e.url.search(/^file:\/\//)&&(n.push(e),n.length>=l.total))return!0}),n}},window.newtab=function(){this.opts={classes:{building:"building",initLoading:"initLoading",sidebarPermanent:"permanent",smallContent:"small",loading:"loading",chromeApps:"chromeApps",suggestions:"suggestions",edit:"edit",add:"add",link:"link",permanentSidebar:"permanentSidebar",remove:"remove",infoBar:"infoBar",save:"save",cancel:"cancel",active:"active",visible:"visible",hidden:"hidden",darkMode:"dark",highContrast:"highContrast",checkbox:{box:"checkbox",active:"active",clicked:"clicked",focus:"focus"}},attr:{type:"data-type",perRow:"data-perRow",pos:"data-pos",style:"data-style"},elm:{body:e("body"),title:e("head > title"),content:e("section#content"),topNav:e("section#content > nav"),search:{wrapper:e("div#search"),field:e("div#search > input[type='text']"),submit:e("div#search > button[type='submit']")},fallbackInfo:e("div#fallbackInfo"),topPages:e("div#topPages")},events:{loaded:"blockbyte-bs-loaded",elementsCreated:"blockbyte-bs-created",openSidebar:"blockbyte-bs-sidebar-open"},manifest:chrome.runtime.getManifest()},this.cl=this.opts.classes,this.attr=this.opts.attr,this.enabledSetAsNewtab=!1,this.run=(()=>{a(),t();let i=this.helper.template.loading().appendTo(this.opts.elm.body);this.opts.elm.body.addClass(this.cl.initLoading),this.helper.model.init().then(()=>{let e=this.helper.model.getData(["a/darkMode","a/highContrast"]);return!0===e.darkMode?this.opts.elm.body.addClass(this.cl.darkMode):!0===e.highContrast&&this.opts.elm.body.addClass(this.cl.highContrast),this.helper.i18n.init()}).then(()=>(this.opts.elm.body.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.font.init(),this.helper.stylesheet.init(),this.helper.stylesheet.addStylesheets(["newtab"],e(document)),this.helper.i18n.parseHtml(document),this.helper.topPages.init(),this.helper.search.init(),this.helper.shortcuts.init(),this.helper.fallback.init(),this.helper.edit.init(),l(),e.delay(500))).then(()=>{i.remove(),this.opts.elm.body.removeClass([this.cl.building,this.cl.initLoading]),e(window).trigger("resize")})});let t=()=>{this.helper={model:new window.ModelHelper(this),template:new window.TemplateHelper(this),i18n:new window.I18nHelper(this),font:new window.FontHelper(this),stylesheet:new window.StylesheetHelper(this),checkbox:new window.CheckboxHelper(this),utility:new window.UtilityHelper(this),search:new window.SearchHelper(this),entry:new window.EntryHelper(this),shortcuts:new window.ShortcutsHelper(this),topPages:new window.TopPagesHelper(this),fallback:new window.FallbackHelper(this),edit:new window.EditHelper(this)}},l=async()=>{chrome.extension.onMessage.addListener(e=>{e&&e.action&&"reinitialize"===e.action&&!1===this.enabledSetAsNewtab&&location.reload(!0)}),this.helper.model.getData("n/autoOpen")&&e(window).on("resize",()=>{if(this.opts.elm.sidebar&&this.opts.elm.sidebar.iframe&&this.opts.elm.sidebar.sidebar){let t=this.opts.elm.sidebar.sidebar.realWidth();window.innerWidth-t>=500?(this.opts.elm.sidebar.sidebar.addClass(this.cl.sidebarPermanent),t>0&&this.opts.elm.content.addClass(this.cl.smallContent),e(document).trigger(this.opts.events.openSidebar),e.delay(500).then(()=>{e(document).trigger("click")})):(this.opts.elm.sidebar.sidebar.removeClass(this.cl.sidebarPermanent),this.opts.elm.content.removeClass(this.cl.smallContent)),this.helper.topPages.handleWindowResize()}})},a=()=>new Promise(t=>{e("["+this.attr.type+"='script_sidebar']").remove();let l=[this.opts.events.loaded,this.opts.events.elementsCreated].join(" ");e(document).off(l).on(l,t=>{this.opts.elm.sidebar=t.detail.elm,e(window).trigger("resize")}),this.opts.manifest.content_scripts[0].css.forEach(t=>{e("<link />").attr({href:chrome.extension.getURL(t),type:"text/css",rel:"stylesheet",[this.attr.type]:"script_sidebar"}).appendTo("head")});let a=(l=0)=>{let i=this.opts.manifest.content_scripts[0].js[l];if(void 0!==i){let t=document.createElement("script");document.head.appendChild(t),t.onload=(()=>a(l+1)),t.src="/"+i,e(t).attr(this.attr.type,"script_sidebar")}else t()};a()})},(new window.newtab).run()})(jsu);